<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../../bower_components/iron-icons/device-icons.html">


<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">


<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">

<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">

<link rel="import" href="./session-element.html">
<link rel="import" href="./shared-styles.html">

<dom-module id="event-card">
  <template>
    <style is="custom-style" include="shared-styles flex flex-alignment"></style>

    <style>
       :host {
        display: block;
      }

      body {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      paper-card {
        max-width: 500px;
      }

      a {
        color: var(--google-blue-500);
      }

      p{
        text-align: center;
      }

      .date-time{
        text-align: center;
      }

      .card-actions {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .cafe-header {
        @apply --paper-font-headline;
      }

      .cafe-light {
        color: var(--paper-grey-600);
      }

      .cafe-location {
        float: right;
        font-size: 15px;
        vertical-align: middle;
      }

      .cafe-button {
        color: var(--google-blue-500);
      }

      iron-icon.star {
        --iron-icon-width: 16px;
        --iron-icon-height: 16px;
        color: var(--paper-amber-500);
      }

      iron-icon.star:last-of-type {
        color: var(--paper-grey-500);
      }
      /* CSS Custom */

      .read-more-state:checked~.read-more-wrap .dotspan {
        display: none;
      }

      .read-more-state~.read-more-trigger:before {
        content: 'read more';
        color: #8e9093
      }

      .read-more-state:checked~.read-more-trigger:before {
        content: 'read less';
        color: #8e9093
      }

      .read-more-trigger {
        cursor: pointer;
        display: block;
        padding: 0 .5em;
        color: #666;
        font-size: .9em;
        line-height: 2;
        text-align: right;
      }


      .read-more-state {
        display: none;
      }

      .read-more-target {
        opacity: 0;
        max-height: 0;
        font-size: 0;
        transition: .25s ease;
      }

      .read-more-state:checked~.read-more-wrap .read-more-target {
        opacity: 1;
        font-size: inherit;
        max-height: 999em;
      }

      .dotspan {
        opacity: 1;
      }
    </style>

    <paper-card image="[[event.image]]">
      <div class="card-content">
        <div class="cafe-header">[[event.name]]
          <div class="cafe-location cafe-light">
            <iron-icon icon="communication:location-on"></iron-icon>
            <a href="[[event.venueUrl]]" target="_blank">[[event.venue]]</a>
          </div>
        </div>
        <br>
        <div class="date-time">
        <iron-icon class="cafe-light" icon="device:access-time"></iron-icon>
        <span class="cafe-light">[[event.startDate]]</span><br>
        <iron-icon  class="cafe-light" icon="device:access-time"></iron-icon>
        <span class="cafe-light">[[event.endDate]]</span>
        </div>

        <input type="checkbox" class="read-more-state" id="post-1" />
        <p class="cafe-light read-more-wrap">[[shortDesc(event.fullDescription, 100)]]<span class="dotspan">...</span><span class="read-more-target">[[longDesc(event.fullDescription, 100)]]</span></p>
        <label for="post-1" class="read-more-trigger"></label>
      </div>
      <div class="card-actions">
        <div class="horizontal justified">
          <paper-button class="cafe-button"><a href="https://www.google.com" target="_blank">Register</a></paper-button>
          <span>|</span>
          <paper-button class="cafe-button" data-name$="[[event.name]]" on-tap="openDialog">Schedule</paper-button>
        </div>
      </div>
    </paper-card>

    <paper-dialog id="modal-[[event.name]]" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
      <!-- <div class="header"> -->
      <h2 style="text-align: center">Schedule</h2>
      <!-- <paper-tabs selected="0" scrollable>
          <paper-tab>The first tab</paper-tab>
          <paper-tab>Tab two</paper-tab>
          <paper-tab>The third tab</paper-tab>
          <paper-tab>Fourth tab</paper-tab>
        </paper-tabs> -->
      <!-- </div> -->
      <paper-dialog-scrollable>
        <pre><code>[[toJson(event.schedule)]]</pre></code></pre>
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus>OK</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>
    class EventCard extends Polymer.Element {
      static get is() {
        return 'event-card';
      }

      static get properties() {
        return {
          event: {
            type: Object
          },
          shortDesc: {
            type: String
          },
          longDesc: {
            type: String
          }
        }
      }

      shortDesc(desc, maxChars) {
        return desc.slice(0, maxChars);
      }

      longDesc(desc, maxChars) {
        let length = desc.length;
        console.log(desc.slice(maxChars, length));
        return desc.slice(maxChars, length);
      }

      openDialog(e) {
          let body = document.querySelector('body');
          let modal = this.shadowRoot.querySelector('#modal-'+ e.target.getAttribute('data-name'));
          let clonedModal = modal.cloneNode(true);
          Polymer.dom(body).appendChild(clonedModal);
          clonedModal.open();
        }

        toJson(data){
          return JSON.stringify(data,null, 4);
        }
    }

    window.customElements.define(EventCard.is, EventCard);
  </script>
</dom-module>